# Домашнее задание к занятию "10.06. Инцидент-менеджмент"
## Задание 1
Составьте постмотрем, на основе реального сбоя системы Github в 2018 году.

Информация о сбое доступна в виде краткой выжимки на русском языке , а также развёрнуто на английском языке.

## Решение
* Описание инцидента
> 21.10.18 в 22:52 было зафиксировано, что платформа Github стала работать в не стабильном режиме. Как итог была отображена устаревшая и непоследовательная информация. Возникло расхождение в данных БД. Неработоспособность сервера наблюдалась в течении 24 часов 11 минут.
* События до
> Были проведены плановые технические работы по замене неисправного оптического оборудования 100G, что привело к потере связи на 43 секунды между узлами US East Coast и дата-центром US East Coast.
* Причина
> Потеря соединения с ЦОД US East Coast привела к рассинхронности кластеров MySQL
* Следствие
> Несогласованность информации, невозможность исполнения событий WebHook и недоступность работы страниц GitHub.
* Обнаружение 
> Инцидент заметили дежурный инженер. Затем привлекли ответственных разработчиков.
* Восстановление 
> Восстановление производилось из резервных копий баз данных и последующей репликацией.
* Время
> 2018.10.21 22:52 - потеря консенсуса между серверами в дата хабах в результате потери связи с ЦОД. После восстановления связи была попытка восстановления целостности кластера, восстановления консенсуса, но данные в БД различались, что привело к несогласованности в рамках кластера

>  2018.10.21 22:54 - Инженеры поддержки зафиксировали на мониторинге несоответствие кластера ожидаемому состоянию, в 23:02 выявлено отсутствие серверов из US East Coast

> 2018.10.21 23:07 - отключены внутренние инструменты развертывания для предотвращения дополнительных изменений. Сайт переведен в желтый статус и автоматически зафиксировал инцидент в системе управления сбоями.
 
> 2018.10.21 23:13 - выявлены воздействия на множественные сервера, введены дополнительные инженеры, выполнены действия для сохранения пользовательских данных.

> 2018.10.21 23:19 - Остановлены некоторые процессы (принудительная деградация) с целью повышения скорости восстановления.
 
> 2018.10.22 00:05 - Разработка плана по восстановления системы и синхронизации репликаций данных. Обновлен статус, чтобы сообщить пользователям, что GitHub собираемся выполнить контролируемую отработку отказа внутренней системы хранения данных.

> 2018.10.22 00:41 - Запущен процесс резервного копирования данных

> 2018.10.22 06:51 - бэкапы US East Coast data center выполнены, запущенно реплецирование с серверов в West Coast.

> 2018.10.22 07:46 - опубликована расширенная информация о ходе восстановления для пользователей

> 2018.10.22 11:12 - Восстановлены серверы в US East Coast, продолжается реплицирование. Наблюдается повышенная нагрузка при реплицировании.

> 2018.10.22 13:15 - Пик нагрузки на GitHub. Отставание репликации до согласованного состояния увеличивается. Подготовка дополнительных реплик чтения MySQL в общедоступном облаке Восточного побережья, распределение потоков с учетом дополнительно развернутых реплик MySQL. Уменьшение средней нагрузки на реплики чтения ускорило догон репликации.

> 2018.10.22 16:24 - реплицирование синхронизировано, переключение в штатную топологию MySQL.
 
> 2018.10.22 16:45 - На этапе восстановления не удалось сбалансировать возросшую нагрузку и в результате около 200000 полезных задач были отброшены ввиду превышения TTL. Остановка обработки и увеличение TTL до полного завершения репликаций и возвращения к штатной работе.

> 2018.10.22 23:03 - Все незавершённые события вебхуков и сборки Pages обработаны, целостность и правильная работа всех систем подтверждена. Статус сайта обновлён на зелёный.

* Последние действия
> В ходе анализа событий был принят ряд технических мер: - Отрегулировать конфигурацию Orchestrator, чтобы запретить перемещение первичных БД за границы региона;

> ускорить миграцию на новую систему отчётности по статусам, которая предоставит более развернутую информацию по инциденту, мы могли выбрать только зелёный, жёлтый и красный статусы для всего сайта, это не даёт точной картины: что работает, а что нет. Новая система будет отображать различные компоненты платформы, чтобы вы знали статус каждой службы;

> запустили общекорпоративную инженерную инициативу для поддержки обслуживания трафика GitHub из нескольких ЦОД по архитектуре active/active/active. Цель данного проекта — поддержка избыточности N+1 на уровне ЦОД, чтобы выдерживать отказ одного ЦОД без вмешательства со стороны.
