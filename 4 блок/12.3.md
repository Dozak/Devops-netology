# Домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"

## Задание 1: Описать требования к кластеру

> Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:
> * База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
> * Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
> * Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
> * Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

|           | CPU                          | RAM                            |
|:----------|:---                          |:-------------------------------|
| Cash      | 1 * 3 = 3 ядра               | 4 * 3 = 12 Гб                  |     
| BD        | 1 * 3 = 3 ядра               | 4 * 3 = 12 Гб                  | 
| Frontend  | 0,2 * 5 = 1 ядро             | 0,05 * 5 = 0,25 Гб             | 
| Backend   | 1 * 10 = 10 ядер             | 0,6 * 10 = 6 Гб                | 
| **Итого** | **3 + 3 + 1 + 10 = 17 ядер** | **12 + 12 + 0,25 + 6 = 31 Гб** | 

Не предъявлены требования по необходимому дисковому пространству, думаю, можно сделать вывод, что заказчик обладает достаточно большим объемом, который можно использовать в зависимости от нужд

Думаю, необходимо сделать расчеты для 3-5 нод, в зависимости от этого, заказчик сможет принять решение на свое усмотрение в сторону отказоустойчивости или же экономии.
Делать меньше 3 нод - это большие риски, а больше 5 не целесообразно.
Для отказоустойчивости предлагаю выделить 3 Control Plane ноды, так как master-нод нужно нечетное кол-во.
CPU = 6 ядер
RAM = 6 Гб

* Worker-ноды

|     | 3 Worker-nodes   | 4 Worker-nodes   | 5 Worker-nodes   |
|:----|:---              |:---              | :---             |
| CPU | 17 + 3 = 20 ядер | 17 + 4 = 21 ядро | 17 + 5 = 22 ядра |    
| RAM | 31 + 3 = 34 Гб   | 31 + 4 = 35 Гб   | 31 + 5 = 36 Гб   |

* Worker-ноды с запасом, на случай выхода из строя как минимум одной ноды.

|       | 3 Worker-nodes            | 4 Worker-nodes            | 5 Worker-nodes           |
|:---   |:---                       |:---                       | :---                     |
| CPU   | (17 * 1,33) + 3 = 26 ядер | (17 * 1,25) + 4 = 26 ядер | (17 * 1,2) + 5 = 26 ядер |    
| RAM   | (31 * 1,33) + 3 = 45 Гб   | (31 * 1,25) + 4 = 43 Гб   | (31 * 1,2) + 5 = 43 Гб   |

* Итоговый расчет

|     | 3 Worker-nodes  | 4 Worker-nodes  | 5 Worker-nodes  |
|:----|:---             |:---             | :---            |
| CPU | 26 / 3 = 9 ядер | 26 / 7 = 7 ядер | 26 / 5 = 6 ядер |    
| RAM | 45 / 3 - 15 Гб  | 43 / 4 = 11 Гб  | 43 / 5 = 9 Гб   |

* Результат:
Достаточно выделить 3 Control Plane по 2 cpu и 2 гб ram на каждую.
Так как расчеты с учетом расчетов отказоустойчивости практически сопоставимы по затратам cpu и ram, то лучше использовать 5 нод.
Достаточно выделить 5 worker-нод по 6 cpu и 9 гб ram на каждую.
Общее число затраченных ресурсов будет равно: 36 cpu и 51 гб ram.